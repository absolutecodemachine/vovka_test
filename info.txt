Документация для кода: Анализатор данных матчей
Описание

Программа предназначена для обработки данных матчей, поступающих от двух источников: Sansabet и Pinnacle, с последующим объединением информации, поиском совпадений и передачей данных клиентам через WebSocket.
Архитектура

    Источники данных:
        Sansabet: Порт 7100
        Pinnacle: Порт 7200
    Клиентский фронтенд:
        Порт 7300
    Основные модули:
        Парсинг данных матчей.
        Сохранение данных в временное хранилище (matchData).
        Сопоставление матчей между двумя источниками.
        Передача результатов клиентам фронтенда.

Главные функции
1. initDB()

Инициализирует подключение к базе данных:

    DSN: matchingTeams:local_password@tcp(localhost:3306)/matchingTeams
    Проверяет доступность базы через Ping.

2. startAnalyzer()

Запускает обработчики данных:

    Парсер Sansabet: Сервер на порту 7100.
    Парсер Pinnacle: Сервер на порту 7200.
    Фронтенд: Сервер на порту 7300.
    Процесс для анализа и сопоставления данных (processPairs()).

3. Сервер для источников данных (startParserServer)

    Параметры:
        port: Порт, на котором работает сервер.
        sourceName: Название источника (Sansabet или Pinnacle).
    Обрабатывает входящие WebSocket-сообщения.
    Сохраняет данные через функцию saveMatchData().

4. Обработка данных (saveMatchData)

    Парсит сообщение через parseMessage().
    Проверяет наличие команд в базе (ensureTeamsExist()).
    Связывает команды с Pinnacle через linkTeamsForMatch().
    Если связь найдена, вызывает updateMatchPairs().

5. Сопоставление матчей (updateMatchPairs)

    Проверяет наличие связи с Pinnacle для домашних и гостевых команд.
    Генерирует ключи для поиска данных в matchData.
    Обновляет пары матчей (matchPairs) для последующего анализа.

6. Генерация ключа (generateMatchKey)

    Генерирует уникальный ключ для пары команд (домашняя и гостевая).

7. Анализ пар матчей (processPairs)

    Периодически обрабатывает пары матчей:
        Удаляет устаревшие данные (TTL: 10 секунд).
        Сопоставляет исходы матчей через findCommonOutcomes().
        Передает результаты клиентам через WebSocket.

Структура данных
ParsedMessage

    MatchId: Уникальный идентификатор матча.
    MatchName: Название матча.
    Home: Название домашней команды.
    Away: Название гостевой команды.

MatchPair

    Данные о сопоставленных матчах из двух источников (Sansabet и Pinnacle).

Порты

    7100: Прием данных от парсера Sansabet.
    7200: Прием данных от парсера Pinnacle.
    7300: Передача данных клиентам фронтенда.

Особенности логирования

    [DEBUG]: Основные действия программы.
    [ERROR]: Ошибки обработки данных.
    [ZAEB]: Временные метки для отладки ключевых функций (можно удалить для продакшна).

Возможности и ограничения

    Сопоставление матчей работает даже если связь найдена только для одной команды.
    TTL данных матчей: 10 секунд.
    ROI рассчитывается для сопоставленных исходов (функции findCommonOutcomes и calculateROI).

Как запустить?

    Убедитесь, что база данных доступна.
    Запустите программу.
    Отправляйте данные на порты 7100 и 7200.
    Подключитесь к фронтенд-серверу на порту 7300 для получения результатов.